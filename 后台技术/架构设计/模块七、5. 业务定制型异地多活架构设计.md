## 异地多活的核心原理---》CAP

![image-20220601223340692](static/images/image-20220601223340692.png)

异地多活架构本质上是AP架构

因为做异地多活是要有分区，而且其中一个分区机房故障，这个时候，你的另外一个机房需要对外提供服务，否则有故障另外一个机房不提供服务了，就不是异地多活的目标了

## 大道至简- CAP

深入CAP  

![image-20220601224819753](static/images/image-20220601224819753.png)

## 异地多活核心原则

### 原则1-》只保证核心业务

![image-20220601225020434](static/images/image-20220601225020434.png)

### 原则2-》只能做到最终一致性

![image-20220601225454785](static/images/image-20220601225454785.png)

### 原则3-》只能保证绝大部分用户

![image-20220601225546832](static/images/image-20220601225546832.png)

## 异地多活设计步骤

![image-20220601225826281](static/images/image-20220601225826281.png)

### 步骤一：业务分级

![image-20220601230058382](static/images/image-20220601230058382.png)

### 步骤二：数据分类

![image-20220601230202848](static/images/image-20220601230202848.png)

### 步骤三：数据同步

![image-20220601230513719](static/images/image-20220601230513719.png)

![image-20220601230520093](static/images/image-20220601230520093.png)

### 步骤四：异常处理

![image-20220601230708067](static/images/image-20220601230708067.png)

## 异地多活设计技巧

### 1. 消息队列同步

![image-20220601230810699](static/images/image-20220601230810699.png)

### 2. 库存拆分

![image-20220601230849615](static/images/image-20220601230849615.png)

### 3. 事务合并

![image-20220601231009978](static/images/image-20220601231009978.png)

### 4. 实时改异步

![image-20220601231150034](static/images/image-20220601231150034.png)

### 5. 适当容忍

![image-20220601231243608](static/images/image-20220601231243608.png)

## 总结

![image-20220601231328540](static/images/image-20220601231328540.png)