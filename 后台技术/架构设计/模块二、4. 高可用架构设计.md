> 鸡蛋篮子第三理论（冗余法则）：不要将所有鸡蛋放在一个篮子里，放在多个篮子里

[TOC]

## 高可用来源

![image-20220410153412173](static/images/image-20220410153412173.png)

## 什么是容忍度

定义：用户能够接受的业务不可用程度，包括时长和影响

![image-20220410153644181](static/images/image-20220410153644181.png)

## 高可用复杂度模型

![image-20220410095228262](static/images/image-20220410095228262.png)

### 计算高可用-->任务分配

![image-20220410100458596](static/images/image-20220410100458596.png)

高性能任务分配考虑的是正常处理，高可用任务分配考虑的是异常处理

#### 任务分配架构设计关键点

![image-20220410100855260](static/images/image-20220410100855260.png)

#### 任务分配案例

nginx

![image-20220410101024906](static/images/image-20220410101024906.png)

计算高性能架构不一定是计算高可用架构。

### 计算搞可用--->任务分解

![image-20220410101126820](static/images/image-20220410101126820.png)

任务分解可以降低故障发生之后的影响程度

#### 任务分解架构设计关键点

![image-20220410101313265](static/images/image-20220410101313265.png)

#### 任务分解案例

![image-20220410101334719](static/images/image-20220410101334719.png)

### 存储高可用复杂度模型

![image-20220410101434175](static/images/image-20220410101434175.png)

#### 存储高可用--->数据复制格式

![image-20220410101746711](static/images/image-20220410101746711.png)

#### 存储高可用--->复制方式

![image-20220410102054856](static/images/image-20220410102054856.png)

* 同步复制

  * 客户端发送一个写请求，收到这个请求的服务器先执行完，然后要同步给所有备份服务器去执行，**全部执行成功之后**，收到请求的服务器才会返回结果给客户端
  * 故障容忍度低：因为它要保证所有结点复制成功才行，如果一个结点挂了 ，那同步复制就不能运行了
  * 写入性能低：一个服务器写入变成多个服务器写入

* 异步赋值

  * 客户端发送一个写请求，收到这个请求的服务器先执行完，然后直接返回给客户端，最后才去异步的去同步给所有备份服务器。
  * 故障容忍度高：有一个备份服务器写失败了，不影响整体
  * 数据不一致：有的服务器写成功了，有的服务器写失败了

  同步复制是指要么全部成功

  异步复制是值要么全部不成功	

![image-20220410102420633](static/images/image-20220410102420633.png)

- 半同步复制
  - 服务器收到请求之后，它先挑选其中一个服务器进行复制，只要这个服务器成功了，它就给客户端返回成功，然后它再把这个数据通过异步的方式复制给其他服务器
- 多数复制
  - 服务器收到请求之后，它需要把数据复制到多数的服务器，只要这些多数服务器复制成功之后，它才认为这个写请求是成功的，剩下的服务器通过异步的方式复制过去

#### 存储高可用案例

![image-20220410105306409](static/images/image-20220410105306409.png)

#### 存储高可用--->状态决策

独裁式

![image-20220410105415207](static/images/image-20220410105415207.png)

数据一致性强度中等，因为上报者之间的数据复制没有很强的一致性算法来保证数据一致性



协商式

![image-20220410105703186](static/images/image-20220410105703186.png)

数据一致性弱：因为互相复制的时候有可能导致数据复制失败或者数据覆盖





民主式

![image-20220410110017369](static/images/image-20220410110017369.png)

#### 存储高可用状态决策案例

独裁式

![image-20220410110147389](static/images/image-20220410110147389.png)

民主式集群

![image-20220410110231104](static/images/image-20220410110231104.png)

![image-20220410110243052](static/images/image-20220410110243052.png)

## 总结

![image-20220410110302850](static/images/image-20220410110302850.png)